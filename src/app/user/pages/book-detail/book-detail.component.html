<main class="max-w-7xl mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-12 gap-6">

  <!-- LEFT: Book detail + Reviews + Services -->
  <div class="lg:col-span-9 space-y-6">

    <!-- Book Detail -->
    <section class="bg-white  shadow p-6">
      <div *ngIf="book" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Image -->
        <div class="flex justify-center">
          <img [src]="book.coverImageUrl || 'https://via.placeholder.com/300x400'" alt="Book Cover"
            class="w-64 h-80 object-cover  " />
        </div>

        <!-- Info -->
        <div class="space-y-4">
          <h1 class="text-2xl font-bold text-gray-900">{{ book.title || 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ' }}</h1>
          <p class="text-gray-600 text-sm">T√°c gi·∫£: <span class="font-medium">{{ book.author || 'Kh√¥ng r√µ'
              }}</span></p>
          <p class="text-blue-600 font-semibold text-lg">{{ book.price ? (book.price | number : '1.0-0') :
            'Li√™n h·ªá' }} VNƒê</p>
          <p class="text-sm text-gray-600">Ng√†y xu·∫•t b·∫£n: {{ book.publishedDate | date:'dd/MM/yyyy' }}</p>
          <p class="text-sm text-gray-600">T·ªìn kho: {{ book.stock || 0 }}</p>
          <p class="text-gray-700 text-sm leading-relaxed">
            <strong>M√¥ t·∫£:</strong><br>
            {{ book.description || 'Kh√¥ng c√≥ m√¥ t·∫£.' }}
          </p>

          <!-- Buttons -->
          <div class="flex space-x-4 pt-4">
            <button (click)="addToCart()"
              class="bg-blue-600 text-white text-sm font-medium px-4 py-2  hover:bg-blue-700">
              <i class="fas fa-cart-plus mr-2"></i> Th√™m
            </button>
            <button (click)="goBack()"
              class="bg-gray-100 text-gray-800 text-sm font-medium px-4 py-2  hover:bg-gray-200">
              <i class="fas fa-arrow-left mr-2"></i> Quay l·∫°i
            </button>

          </div>
        </div>
      </div>

      <ng-template #loading>
        <div class="text-center text-gray-500">ƒêang t·∫£i th√¥ng tin s√°ch...</div>
      </ng-template>
    </section>

    <!-- REVIEW SECTION (ƒë∆∞a l√™n ƒë√¢y) -->
    <section class="bg-white  shadow p-6 space-y-6">
      <div>
        <h2 class="text-lg font-semibold text-gray-800 mb-4">üìù ƒê√°nh gi√° s√°ch</h2>

        <form (ngSubmit)="submitReview()" #reviewForm="ngForm" class="space-y-4">
          <div class="flex items-center space-x-2">
            <label for="rating" class="text-sm font-medium">S·ªë sao:</label>
            <select name="rating" [(ngModel)]="review.rating" required
              class="border border-gray-300  px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option [value]="null">-- Ch·ªçn sao --</option>
              <option *ngFor="let r of [1, 2, 3, 4, 5]" [value]="r">{{ r }} ‚≠ê</option>
            </select>
          </div>

          <div>
            <textarea name="comment" [(ngModel)]="review.comment" required placeholder="Nh·∫≠p nh·∫≠n x√©t c·ªßa b·∫°n..."
              class="w-full border border-gray-300  px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
              rows="3"></textarea>
          </div>

          <!-- N√∫t g·ª≠i qua ph·∫£i -->
          <div class="flex justify-end">
            <button type="submit" [disabled]="!reviewForm.form.valid"
              class="bg-blue-600 text-white px-5 py-2  hover:bg-blue-700 text-sm font-medium flex items-center space-x-1">
              <i class="fas fa-paper-plane"></i>
              <span>G·ª≠i ƒë√°nh gi√°</span>
            </button>
          </div>
        </form>
      </div>

      <div>
        <h3 class="text-base font-semibold text-gray-800 mb-2">ƒê√°nh gi√° t·ª´ ng∆∞·ªùi d√πng üì¢</h3>

        <ng-container *ngIf="reviews.length > 0; else noReview">
          <div *ngFor="let r of reviews"
            class="border border-gray-200  p-4 bg-gray-50 shadow-sm space-y-2 mb-4">
            <div class="flex items-center justify-between">
              <span class="font-medium text-blue-600">{{ r.username || '·∫®n danh' }}</span>
              <div class="flex space-x-0.5 text-yellow-400 text-sm">
                <ng-container *ngFor="let s of [1, 2, 3, 4, 5]">
                  <i [class]="s <= r.rating ? 'fas fa-star' : 'far fa-star'"></i>
                </ng-container>
              </div>
            </div>
            <p class="text-sm text-gray-700">{{ r.comment }}</p>

            <!-- N√∫t ch·ªânh s·ª≠a & x√≥a -->
            <div class="flex justify-end gap-4">
              <button *ngIf="r.userId === currentUserId" (click)="editReview(r)"
                class="text-blue-600 text-sm hover:underline flex items-center gap-1 cursor-pointer">
                ‚úèÔ∏è Ch·ªânh s·ª≠a
              </button>

              <button *ngIf="r.userId === currentUserId" (click)="deleteReview(r.reviewId)"
                class="text-red-600 text-sm hover:underline flex items-center gap-1">
                üóëÔ∏è X√≥a
              </button>
            </div>
          </div>
        </ng-container>

        <ng-template #noReview>
          <p class="text-sm text-gray-500">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o cho s√°ch n√†y.</p>
        </ng-template>
      </div>
    </section>




    <!-- RANDOM BOOKS SECTION -->
    <section>
      <h2 class="text-lg font-semibold text-gray-800 mb-4">C√≥ th·ªÉ b·∫°n s·∫Ω th√≠ch üî•</h2>
      <ul class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 xl:grid-cols-4 gap-6 justify-center pt-2">
        <li *ngFor="let book of randomBooks"
          class="bg-white border border-gray-200  p-4 flex flex-col items-center text-center shadow-sm">

          <div class="mb-2 text-left w-full">
            <span class="bg-blue-600 text-white text-xs font-semibold  px-2 py-0.5">M·ªõi</span>
          </div>

          <img [src]="book.coverImageUrl || 'https://via.placeholder.com/120x180'" alt="Book Image"
            class="w-full h-36 object-contain mb-3" />

          <h3 class="text-sm font-semibold text-gray-900">{{ book.title || 'Kh√¥ng ti√™u ƒë·ªÅ' }}</h3>

          <div class="flex items-center justify-center text-yellow-400 text-xs mb-1">
            <i class="fas fa-star"></i><i class="fas fa-star"></i>
            <i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>
            <span class="ml-1 text-gray-400">(2)</span>
          </div>

          <p class="text-xs text-gray-500">T√°c gi·∫£: {{ book.author || '·∫®n danh' }}</p>
          <p class="text-blue-600 font-semibold mb-3">
            {{ book.price ? (book.price | number : '1.0-0') : 'Li√™n h·ªá' }} VNƒê
          </p>

          <div class="flex justify-center items-center space-x-2">
            <button class="bg-blue-100 text-blue-600 text-xs font-semibold  px-3 py-1 hover:bg-blue-200">
              <i class="fas fa-cart-plus mr-1"></i> Th√™m
            </button>
            <button (click)="goToDetail(book.bookId!)"
              class="bg-gray-100 text-gray-700 text-xs font-semibold px-3 py-1  hover:bg-gray-200">
              <i class="fas fa-eye mr-1"></i> Xem
            </button>
          </div>
        </li>
      </ul>

      <div class="pt-6 flex justify-center">
        <button class="bg-blue-600 text-white text-sm font-medium px-6 py-2  hover:bg-blue-700 transition"
          (click)="goToStore()">
          <i class="fas fa-arrow-right"></i> Xem t·∫•t c·∫£
        </button>
      </div>

    </section>

  </div>

  <!-- RIGHT: Danh s√°ch s√°ch c√πng th·ªÉ lo·∫°i -->
  <aside class="lg:col-span-3 space-y-4">
    <h2 class="text-lg font-semibold text-gray-800 mb-3">S√°ch c√πng th·ªÉ lo·∫°i</h2>
    <div *ngFor="let item of books" class="bg-white  shadow p-3 flex items-center space-x-3">
      <img (click)="goToDetail(item.bookId!)" [src]="item.coverImageUrl || 'https://via.placeholder.com/60x80'"
        alt="Thumb" class="w-14 h-18 object-cover  cursor-pointer" />
      <div class="flex-1">
        <h3 class="text-xs font-semibold text-gray-900 truncate">{{ item.title }}</h3>
        <p class="text-xs text-gray-600 truncate">T√°c gi·∫£: {{ item.author }}</p>
        <p class="text-blue-600 text-sm font-semibold">{{ item.price | number : '1.0-0' }} ƒë</p>
      </div>
    </div>
  </aside>

</main>

  <!-- D·ªãch v·ª• Bookstore -->
                <section class="grid grid-cols-2 md:grid-cols-4 gap-4 p-4 max-w-7xl mx-auto">
                    <!-- D·ªãch v·ª• 1 -->
                    <div class="bg-white p-6   border border-gray-200">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-blue-100  flex items-center justify-center">
                                <i class="fas fa-headset text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-lg font-bold text-gray-800">H·ªó tr·ª£ 24/7</p>
                                <p class="text-gray-600 text-sm">T∆∞ v·∫•n & CSKH nhi·ªát t√¨nh</p>
                            </div>
                        </div>
                    </div>

                    <!-- D·ªãch v·ª• 2 -->
                    <div class="bg-white p-6   border border-gray-200">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-green-100  flex items-center justify-center">
                                <i class="fas fa-truck-moving text-green-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-lg font-bold text-gray-800">Giao nhanh</p>
                                <p class="text-gray-600 text-sm">Giao h√†ng to√†n qu·ªëc 2-3 ng√†y</p>
                            </div>
                        </div>
                    </div>

                    <!-- D·ªãch v·ª• 3 -->
                    <div class="bg-white p-6   border border-gray-200">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-purple-100  flex items-center justify-center">
                                <i class="fas fa-gift text-purple-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-lg font-bold text-gray-800">G√≥i qu√† mi·ªÖn ph√≠</p>
                                <p class="text-gray-600 text-sm">H·ªó tr·ª£ g√≥i qu√† d·ªãp ƒë·∫∑c bi·ªát</p>
                            </div>
                        </div>
                    </div>

                    <!-- D·ªãch v·ª• 4 -->
                    <div class="bg-white p-6 border border-gray-200">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-yellow-100  flex items-center justify-center">
                                <i class="fas fa-undo text-yellow-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-lg font-bold text-gray-800">ƒê·ªïi tr·∫£ d·ªÖ d√†ng</p>
                                <p class="text-gray-600 text-sm">ƒê·ªïi tr·∫£ trong 7 ng√†y n·∫øu l·ªói</p>
                            </div>
                        </div>
                    </div>
                </section>