<!-- auth-modal.component.html -->
<div *ngIf="isVisible" class="modal-backdrop flex items-center justify-center z-50 p-4">
  <div
    class="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-screen overflow-auto transform transition-all duration-300 scale-100">

    <!-- Header -->
    <div class="relative bg-gradient-to-r from-blue-600 to-blue-700 rounded-t-2xl py-4 px-5 text-center">
      <button (click)="closeModal()" class="absolute top-4 right-4 text-white hover:text-gray-200 transition-colors">
        <i class="fas fa-times text-xl"></i>
      </button>

      <div class="flex items-center justify-center mb-4">
        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
          <i class="fas fa-book text-white text-xl"></i>
        </div>
      </div>

      <h2 class="text-2xl font-bold text-white mb-2">BookStore</h2>
      <p class="text-blue-100 text-sm">
        <span *ngIf="isLoginMode">Chào mừng bạn trở lại!</span>
        <span *ngIf="isRegisterMode">Tạo tài khoản mới</span>
        <span *ngIf="isForgotPasswordMode">Khôi phục mật khẩu</span>
        <span *ngIf="isResetPasswordMode">Đặt lại mật khẩu</span>
      </p>
    </div>

    <!-- Body -->
    <div class="p-6">

      <!-- Mode Toggle (Only show for login/register) -->
      <div *ngIf="isLoginMode || isRegisterMode" class="flex bg-gray-100 rounded-lg p-1 mb-6">
        <button (click)="setMode('login')" [class]="isLoginMode ? 'bg-blue-600 text-white' : 'text-gray-600'"
          class="flex-1 py-2 px-4 rounded-md font-medium transition-all duration-200">
          Đăng nhập
        </button>
        <button (click)="setMode('register')" [class]="isRegisterMode ? 'bg-blue-600 text-white' : 'text-gray-600'"
          class="flex-1 py-2 px-4 rounded-md font-medium transition-all duration-200">
          Đăng ký
        </button>
      </div>

      <!-- Back to Login Button (For forgot/reset password modes) -->
      <div *ngIf="isForgotPasswordMode || isResetPasswordMode" class="mb-6">
        <button (click)="backToLogin()"
          class="flex items-center text-blue-600 hover:text-blue-700 font-medium transition-colors">
          <i class="fas fa-arrow-left mr-2"></i>
          Quay lại đăng nhập
        </button>
      </div>

      <!-- Success Message -->
      <div *ngIf="successMessage"
        class="mb-4 p-3 bg-green-100 border border-green-300 text-green-700 rounded-lg text-sm">
        <i class="fas fa-check-circle mr-2"></i>{{ successMessage }}
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm">
        <i class="fas fa-exclamation-circle mr-2"></i>{{ errorMessage }}
      </div>

      <!-- Login Form -->
      <form *ngIf="isLoginMode" [formGroup]="loginForm" (ngSubmit)="onLogin()" class="space-y-4">

        <!-- Email -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <div class="relative">
            <input type="email" formControlName="email" placeholder="Nhập email của bạn"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              [class.border-red-500]="loginForm.get('email')?.touched && loginForm.get('email')?.errors">
            <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div *ngIf="getFieldError(loginForm, 'email')" class="text-red-500 text-xs mt-1">
            {{ getFieldError(loginForm, 'email') }}
          </div>
        </div>

        <!-- Password -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Mật khẩu</label>
          <div class="relative">
            <input type="password" formControlName="password" placeholder="Nhập mật khẩu"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              [class.border-red-500]="loginForm.get('password')?.touched && loginForm.get('password')?.errors">
            <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div *ngIf="getFieldError(loginForm, 'password')" class="text-red-500 text-xs mt-1">
            {{ getFieldError(loginForm, 'password') }}
          </div>
        </div>

        <!-- Remember & Forgot -->
        <div class="flex items-center justify-between text-sm">
          <label class="flex items-center">
            <input type="checkbox" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
            <span class="ml-2 text-gray-600">Ghi nhớ đăng nhập</span>
          </label>
          <button type="button" (click)="showForgotPassword()" class="text-blue-600 hover:text-blue-700 font-medium">
            Quên mật khẩu?
          </button>
        </div>

        <!-- Submit Button -->
        <button type="submit" [disabled]="isLoading"
          class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center">
          <i *ngIf="isLoading" class="fas fa-spinner fa-spin mr-2"></i>
          {{ isLoading ? 'Đang đăng nhập...' : 'Đăng nhập' }}
        </button>
      </form>

      <!-- Register Form -->
      <form *ngIf="isRegisterMode" [formGroup]="registerForm" (ngSubmit)="onRegister()" class="space-y-4">

        <!-- Username -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tên đăng nhập</label>
          <div class="relative">
            <input type="text" formControlName="username" placeholder="Nhập tên đăng nhập"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              [class.border-red-500]="registerForm.get('username')?.touched && registerForm.get('username')?.errors">
            <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div *ngIf="getFieldError(registerForm, 'username')" class="text-red-500 text-xs mt-1">
            {{ getFieldError(registerForm, 'username') }}
          </div>
        </div>

        <!-- Email -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <div class="relative">
            <input type="email" formControlName="email" placeholder="Nhập email của bạn"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              [class.border-red-500]="registerForm.get('email')?.touched && registerForm.get('email')?.errors">
            <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div *ngIf="getFieldError(registerForm, 'email')" class="text-red-500 text-xs mt-1">
            {{ getFieldError(registerForm, 'email') }}
          </div>
        </div>

        <!-- Password -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Mật khẩu</label>
          <div class="relative">
            <input type="password" formControlName="password" placeholder="Nhập mật khẩu (tối thiểu 6 ký tự)"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              [class.border-red-500]="registerForm.get('password')?.touched && registerForm.get('password')?.errors">
            <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div *ngIf="getFieldError(registerForm, 'password')" class="text-red-500 text-xs mt-1">
            {{ getFieldError(registerForm, 'password') }}
          </div>
        </div>

        <!-- Confirm Password -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Xác nhận mật khẩu</label>
          <div class="relative">
            <input type="password" formControlName="confirmPassword" placeholder="Nhập lại mật khẩu"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              [class.border-red-500]="registerForm.get('confirmPassword')?.touched && registerForm.get('confirmPassword')?.errors">
            <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div *ngIf="getFieldError(registerForm, 'confirmPassword')" class="text-red-500 text-xs mt-1">
            {{ getFieldError(registerForm, 'confirmPassword') }}
          </div>
        </div>

        <!-- Terms & Conditions -->
        <div class="flex items-start">
          <input type="checkbox" required
            class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1">
          <span class="ml-2 text-sm text-gray-600">
            Tôi đồng ý với
            <a href="#" class="text-blue-600 hover:text-blue-700 font-medium">Điều khoản dịch vụ</a>
            và
            <a href="#" class="text-blue-600 hover:text-blue-700 font-medium">Chính sách bảo mật</a>
          </span>
        </div>

        <!-- Submit Button -->
        <button type="submit" [disabled]="isLoading"
          class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center">
          <i *ngIf="isLoading" class="fas fa-spinner fa-spin mr-2"></i>
          {{ isLoading ? 'Đang đăng ký...' : 'Đăng ký' }}
        </button>
      </form>

      <!-- Forgot Password Form -->
      <form *ngIf="isForgotPasswordMode" [formGroup]="forgotPasswordForm" (ngSubmit)="onForgotPassword()"
        class="space-y-4">

        <div class="text-center mb-6">
          <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-key text-blue-600 text-2xl"></i>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Quên mật khẩu?</h3>
          <p class="text-sm text-gray-600">
            Nhập email của bạn và chúng tôi sẽ gửi liên kết khôi phục mật khẩu
          </p>
        </div>

        <!-- Email -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <div class="relative">
            <input type="email" formControlName="email" placeholder="Nhập email của bạn"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              [class.border-red-500]="forgotPasswordForm.get('email')?.touched && forgotPasswordForm.get('email')?.errors">
            <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div *ngIf="getFieldError(forgotPasswordForm, 'email')" class="text-red-500 text-xs mt-1">
            {{ getFieldError(forgotPasswordForm, 'email') }}
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" [disabled]="isLoading"
          class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center">
          <i *ngIf="isLoading" class="fas fa-spinner fa-spin mr-2"></i>
          {{ isLoading ? 'Đang gửi email...' : 'Gửi email khôi phục' }}
        </button>
      </form>

      <!-- Reset Password Form -->
      <form *ngIf="isResetPasswordMode" [formGroup]="resetPasswordForm" (ngSubmit)="onResetPassword()"
        class="space-y-4">

      <div class="text-center mb-6">
    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <i class="fas fa-lock text-green-600 text-2xl"></i>
    </div>
    <h3 class="text-lg font-semibold text-gray-900 mb-2">Đặt lại mật khẩu</h3>
    <p class="text-sm text-gray-600">
      Nhập email, mã xác thực và mật khẩu mới của bạn
    </p>
  </div>

  <!-- Email -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
    <div class="relative">
      <input type="email" 
             formControlName="email"
             placeholder="Nhập email của bạn"
             class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
             [class.border-red-500]="resetPasswordForm.get('email')?.touched && resetPasswordForm.get('email')?.errors">
      <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
    </div>
    <div *ngIf="getFieldError(resetPasswordForm, 'email')" class="text-red-500 text-xs mt-1">
      {{ getFieldError(resetPasswordForm, 'email') }}
    </div>
  </div>
        <!-- Token -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Mã xác thực</label>
          <div class="relative">
            <input type="text" formControlName="token" placeholder="Nhập mã xác thực từ email"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              [class.border-red-500]="resetPasswordForm.get('token')?.touched && resetPasswordForm.get('token')?.errors">
            <i class="fas fa-key absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div *ngIf="getFieldError(resetPasswordForm, 'token')" class="text-red-500 text-xs mt-1">
            {{ getFieldError(resetPasswordForm, 'token') }}
          </div>
        </div>

        <!-- New Password -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Mật khẩu mới</label>
          <div class="relative">
            <input type="password" formControlName="newPassword" placeholder="Nhập mật khẩu mới"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              [class.border-red-500]="resetPasswordForm.get('newPassword')?.touched && resetPasswordForm.get('newPassword')?.errors">
            <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div *ngIf="getFieldError(resetPasswordForm, 'newPassword')" class="text-red-500 text-xs mt-1">
            {{ getFieldError(resetPasswordForm, 'newPassword') }}
          </div>
        </div>

        <!-- Confirm New Password -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Xác nhận mật khẩu mới</label>
          <div class="relative">
            <input type="password" formControlName="confirmNewPassword" placeholder="Nhập lại mật khẩu mới"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              [class.border-red-500]="resetPasswordForm.get('confirmNewPassword')?.touched && resetPasswordForm.get('confirmNewPassword')?.errors">
            <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div *ngIf="getFieldError(resetPasswordForm, 'confirmNewPassword')" class="text-red-500 text-xs mt-1">
            {{ getFieldError(resetPasswordForm, 'confirmNewPassword') }}
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" [disabled]="isLoading"
          class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center">
          <i *ngIf="isLoading" class="fas fa-spinner fa-spin mr-2"></i>
          {{ isLoading ? 'Đang đặt lại...' : 'Đặt lại mật khẩu' }}
        </button>
      </form>
    </div>
  </div>
</div>
<!-- End auth-modal.component.html -->